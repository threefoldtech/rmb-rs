syntax = "proto3";

message Request {
  // command queue to use on receiver side
  string command = 1;
  // pay load of th emssage
  bytes data = 2;
  // the reply queue used to receive the reply on
  string reply_to = 3;
  // message TTL from the time of send
  uint32 expiration = 4;
}

message Error {
  // error code (app specific)
  uint32 code = 1;
  // error message
  string message = 2;
}

// a reply is only data, but it get it's own type
// to support extending later.
message Reply { bytes data = 1; }

// a response can be an error, or data
message Response {
  string reply_to = 1;
  oneof body {
    Reply reply = 2;
    Error error = 3;
  }
}

message Envelope {
  // uid is auto generated by rmb. locally unique
  string uid = 1;
  // client specific id.
  string reference = 2;
  // client specific tags
  optional string tags = 3;
  // timestamp of sending the envlope
  uint64 timestamp = 4;
  // sender id
  uint32 source = 5;
  // destination of the envlope
  repeated uint32 destinations = 6;
  // message inside the envlope
  oneof message {
    Request request = 7;
    Response response = 8;
  }
  // signature
  optional bytes signature = 9;
}
